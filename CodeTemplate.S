INCLUDE	SYSTEM.S
RSSET	USERRAM
PLAYX:		RS.L	0
PLAY1X:		RS.W	1
PLAY2X:		RS.W	1
PLAYY:		RS.L	0
PLAY1Y:		RS.W	1
PLAY2Y:		RS.W	1
TEMPSCREEN:	RS.B	4096
TEMPSCREEN2:	RS.B	4096

%GE_USERVAR%

ENDVARS:	RS.B	0

USERINIT:	MOVE.W	#0,PLAY1X
		MOVE.W	#0,PLAY1Y
		MOVE.W	#0,PLAY2X
		MOVE.W	#0,PLAY2Y

		DMADUMP	MAPGFX,%GE_NUM_BG_CHARS%*32,$20
		DMADUMP	SPRITEGFX,%GE_NUM_SPRITE_CHARS%*32,$1000

		LEA.L	TEMPSCREEN,A0
		LEA.L	CHARGFX,A1
		MOVE.L	D0,#4095
@SET_P1		MOVE.B	(A1)+,(A0)+
		DBRA	D0,@SET_P1

		LEA.L	TEMPSCREEN2,A0
		LEA.L	CHARGFX2,A1
		MOVE.L	D0,#4095
@SET_P2		MOVE.B	(A1)+,(A0)+
		DBRA	D0,@SET_P2

		DMADUMP	TEMPSCREEN,4096,$C000
		DMADUMP	TEMPSCREEN2,4096,$E000

		LEA.L	PALETTE1,A0
		BSR	SETPAL1

		LEA.L	PALETTE2,A0
		BSR	SETPAL2

		LEA.L	PALETTE3,A0
		BSR	SETPAL3

		LEA.L	PALETTE4,A0
		BSR	SETPAL4

		JSR	DUMPCOLS

%GE_INIT%

		RTS

MAIN:		WAITVBI
%GE_ONTICK%
		MOVE.B	JOYPAD0,D0
		AND.L	#FF,D0
; BITS = SACBRLDU
		BTST	#1,D0
		BNE.S	GE_NOT_UP:
%GE_ON_PRESS_UP%
GE_NOT_UP:
		BTST	#2,D0
		BNE.S	GE_NOT_DOWN
%GE_ON_PRESS_DOWN%
GE_NOT_DOWN:
		BTST	#3,D0
		BNE.S	GE_NOT_LEFT
%GE_ON_PRESS_LEFT%
GE_NOT_LEFT:
		BTST	#4,D0
		BNE.S	GE_NOT_RIGHT
%GE_ON_PRESS_RIGHT%
GE_NOT_RIGHT:
		BTST	#5,D0
		BNE.S	GE_NOT_A
%GE_ON_PRESS_A%
GE_NOT_A:
		BTST	#6,D0
		BNE.S	GE_NOT_B
%GE_ON_PRESS_B%
GE_NOT_B:
		BTST	#7,D0
		BNE.S	GE_NOT_C
%GE_ON_PRESS_C%
GE_NOT_C:
		BTST	#8,D0
		BNE.S	GE_NOT_SELECT
%GE_ON_PRESS_SELECT%
GE_NOT_SELECT:
		BRA	MAIN

USERVBI:	LEA.L	VDP_DATA,A1
		LEA.L	VDP_CONTROL,A2
		MOVE.L	#$7C000003,(A2)
		MOVE.L	PLAYX,(A1)
		MOVE.L	#$40000010,(A2)
		MOVE.L	PLAYY,(A1)
		JSR	SPRITEDUMP
		BSR	READJOY
%GE_ONVBI%
		RTS

%GE_SPRITES%
%GE_BG%
%GE_BG_LAYOUT%
%GE_PALLETES%